{"version":3,"file":"index.js","sources":["../index.js"],"sourcesContent":["import FS from 'fs-extra';\nimport Minimist from 'minimist';\nimport { rollup, watch } from 'rollup';\n\nimport nodePlugin from 'rollup-plugin-commonjs';\nimport babelPlugin from 'rollup-plugin-babel';\nimport terserPlugin from 'rollup-plugin-terser';\nimport bundlesizePlugin from 'rollup-plugin-bundle-size';\nimport noderesolvePlugin from 'rollup-plugin-node-resolve';\n\nconst SHEBANG = '#!/usr/bin/env node';\n\nlet args = Minimist(process.argv, {\n\talias: { w: 'watch', i: 'input' },\n\tdefault: { watch: false },\n});\n\nlet pkg = FS.readJSONSync('package.json');\n\nlet bundleInput = () => {\n\tif (pkg.source) return pkg.source;\n\tif (FS.existsSync('index.js')) return 'index.js';\n\tif (FS.existsSync('src/index.js')) return 'src/index.js';\n};\n\nlet bundleExternals = () => {\n\tlet dependencies = [...Object.keys(pkg.dependencies || {}), ...Object.keys(pkg.peerDependencies || {})];\n\n\treturn dependency => {\n\t\tif (dependency.startsWith('@babel/runtime')) {\n\t\t\treturn dependencies.includes('@babel/runtime');\n\t\t} else {\n\t\t\treturn dependencies.includes(dependency);\n\t\t}\n\t};\n};\n\nlet bundleExecutables = () => {\n\tif (pkg.bin != undefined) {\n\t\tif (typeof pkg.bin === 'string') {\n\t\t\treturn [pkg.bin];\n\t\t} else if (typeof pkg.bin === 'object') {\n\t\t\treturn Object.values(pkg.bin);\n\t\t}\n\t}\n\treturn [];\n};\n\nlet bundlePlugins = () => {\n\tlet babel = babelPlugin({ runtimeHelpers: true });\n\tlet node = nodePlugin();\n\tlet terser = terserPlugin.terser({ mangle: false, safari10: true, sourcemap: true });\n\tlet resolve = noderesolvePlugin();\n\tlet bundlesize = bundlesizePlugin();\n\treturn [babel, resolve, node, terser, bundlesize];\n};\n\nlet run = async () => {\n\tlet input = {\n\t\tinput: bundleInput(),\n\t\texternal: bundleExternals(),\n\t\tplugins: bundlePlugins(),\n\t};\n\n\tlet output = [];\n\n\tlet types = {};\n\ttypes['main'] = 'cjs';\n\ttypes['module'] = 'es';\n\ttypes['umd:main'] = 'umd';\n\n\tlet executables = bundleExecutables();\n\n\tfor (let prop in types) {\n\t\tlet file = pkg[prop];\n\t\tif (file == undefined) continue;\n\n\t\toutput.push({\n\t\t\tfile,\n\t\t\tformat: types[prop],\n\t\t\tbanner: executables.includes(file) && SHEBANG,\n\t\t\tsourcemap: true,\n\t\t});\n\t}\n\n\tif (args.watch) {\n\t\tlet watcher = await watch({ ...input, output });\n\t\twatcher.on('event', event => {\n\t\t\tif (event.error) {\n\t\t\t\tconsole.error(event.error.message);\n\t\t\t}\n\t\t});\n\t} else {\n\t\ttry {\n\t\t\tlet bundle = await rollup(input);\n\t\t\tfor (let config of output) {\n\t\t\t\tawait bundle.write(config);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(error.message);\n\t\t}\n\t}\n};\n\nrun();\n"],"names":["SHEBANG","args","Minimist","process","argv","alias","w","i","default","watch","pkg","FS","readJSONSync","bundleInput","source","existsSync","bundleExternals","dependencies","Object","keys","peerDependencies","dependency","startsWith","includes","bundleExecutables","undefined","bin","values","bundlePlugins","babel","babelPlugin","runtimeHelpers","node","nodePlugin","terser","terserPlugin","mangle","safari10","sourcemap","noderesolvePlugin","bundlesizePlugin","run","async","input","external","plugins","output","types","executables","prop","file","push","format","banner","on","event","error","console","message","bundle","rollup","config","write"],"mappings":";kiBAUA,MAAMA,QAAU,sBAEhB,IAAIC,KAAOC,SAASC,QAAQC,KAAM,CACjCC,MAAO,CAAEC,EAAG,QAASC,EAAG,SACxBC,QAAS,CAAEC,OAAO,KAGfC,IAAMC,GAAGC,aAAa,gBAEtBC,YAAc,IACbH,IAAII,OAAeJ,IAAII,OACvBH,GAAGI,WAAW,YAAoB,WAClCJ,GAAGI,WAAW,gBAAwB,sBAGvCC,gBAAkB,SACjBC,aAAe,IAAIC,OAAOC,KAAKT,IAAIO,cAAgB,OAAQC,OAAOC,KAAKT,IAAIU,kBAAoB,YAE5FC,YACFA,WAAWC,WAAW,kBAClBL,aAAaM,SAAS,kBAEtBN,aAAaM,SAASF,aAK5BG,kBAAoB,QACRC,MAAXf,IAAIgB,IAAkB,IACF,iBAAZhB,IAAIgB,UACP,CAAChB,IAAIgB,KACN,GAAuB,iBAAZhB,IAAIgB,WACdR,OAAOS,OAAOjB,IAAIgB,WAGpB,IAGJE,cAAgB,SACfC,MAAQC,YAAY,CAAEC,gBAAgB,IACtCC,KAAOC,aACPC,OAASC,aAAaD,OAAO,CAAEE,QAAQ,EAAOC,UAAU,EAAMC,WAAW,UAGtE,CAACT,MAFMU,oBAEUP,KAAME,OADbM,qBAIdC,IAAMC,cACLC,MAAQ,CACXA,MAAO9B,cACP+B,SAAU5B,kBACV6B,QAASjB,iBAGNkB,OAAS,GAETC,MAAQ,CACZA,KAAgB,MAChBA,OAAkB,KAClBA,WAAoB,OAEhBC,YAAcxB,wBAEb,IAAIyB,QAAQF,MAAO,KACnBG,KAAOxC,IAAIuC,MACHxB,MAARyB,MAEJJ,OAAOK,KAAK,CACXD,KAAAA,KACAE,OAAQL,MAAME,MACdI,OAAQL,YAAYzB,SAAS2B,OAASlD,QACtCsC,WAAW,OAITrC,KAAKQ,MAAO,QACKA,aAAM,IAAKkC,MAAOG,OAAAA,UAC9BQ,GAAG,QAASC,QACfA,MAAMC,OACTC,QAAQD,MAAMD,MAAMC,MAAME,wBAKvBC,aAAeC,cAAOjB,WACrB,IAAIkB,UAAUf,aACZa,OAAOG,MAAMD,QAEnB,MAAOL,OACRC,QAAQD,MAAMA,MAAME,WAKvBjB"}